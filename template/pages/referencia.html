<div id="openModalPadre" class="modalDialogPadre">
    <div> <a href="#close" title="Close" class="close"><i class="btn-outline-danger btn-outline-danger icofont-ui-close"></i>
    </a>            
   
      


      
    <table id="tableReferencia"
        data-locale="es-SP"
        class="table "
        data-toggle="table"
        data-click-to-select="true"
        data-pagination="true"
        data-ajax="ajaxRequest"
        data-search="true"
        data-show-fullscreen="true"        
        data-show-refresh="true"
        data-show-export="true" 
        data-url=""        
        > 
        <div class="row">
          <div class="col-sm-2">
          <a href="#openModalHijo"> 
              <i class="btn text-center btn-outline-success icofont-ui-add"> Agregar </i>
          </a>
        </div>
        
        <div class="col-sm-2">
          <div id="">
            <button id="buttonEditar" class="btn btn-outline-warning icofont-ui-edit"><a href="#openModalHijoDos">Editar</a> </button>
          </div>
        </div>

        <div class="col-sm-2">
          <div id="toolbar">
            <button id="button" class="btn btn-outline-danger icofont-ui-remove"> Eliminar</button>
          </div>
        </div>
        
    </div>

        <thead>                    
            <tr>
                <th class="text-center" data-field="state" data-checkbox="true"></th>
                <th data-field="id">NÂ°-ID</th>
                <th class="text-center" data-field="nom_referencia">Nombre Referencia <i class="icofont-atom"></i></th>
                <th class="text-center" data-field="descripcion">Descripcion de Referencia <i   class="icofont-brand-appstore"></i></th>
                <th class="text-center">Imagen 1
                  <img data-field="fotoPrendaUno">
                  </th>

               

                <th class="text-center" data-field="fotoPrendaDos">Imagen 1  <i class="icofont-image"></i></th>
                <th class="text-center" data-field="created_at">Fecha Creada <i class=""></i></th>
                
            </tr>
        </thead>     
     
    </table>
    
    </div>  

</div>  

<div id="openModalHijo" class="modalDialogHijo">

  


    <div> <a href="#close" title="Close" class="close"><i class="btn-outline-danger icofont-ui-close"></i></a>            
      <div class="">
    
      <form id="addReferencia">
        <div class="content p-3 mb-2 bg-dar text-white ">
          <div class="border">
            <center>        
              <h1>Crear referencia {% for i in nomEmpresaU %}{{ i }}{% endfor %}</h1><hr>
            </center>
              
          
            <div class="col-sm-12">
            <div class="form-group">
              <label for="modal_codigo_color">Nombre Referencia</label>
              <div class="input-group">
                <span class="input-group-addon">
                  <i class="fa fa-user"></i>
                </span>
                <input class="form-control" type="text" name="nom_referencia" placeholder="Nombre referencia" required>
              </div>
            </div>
            </div>
            <div class="col-sm-12">
              <div class="form-group">
                <label for="modal_codigo_color">Descripcion de Referencia</label>
                <div class="input-group">
                  <span class="input-group-addon">
                    <i class="fa fa-user"></i>
                  </span>
                  <input class="form-control" type="text" name="descripcion" min="10" max="100" placeholder="Descripcion" required>
                </div>
              </div>
            </div>        
            <div class="col-sm-12">
              <div class="form-group">
                <label for="modal_codigo_color">Img1</label>
                <div class="input-group">
                  <span class="input-group-addon">
                    <i class="fa fa-user"></i>
                  </span>
                  <input class="form-control file " type="file" name="img1" >
                </div>
              </div>
            </div>
            <div class="col-sm-12">
              <div class="form-group">
                <label for="modal_codigo_color">Img2</label>
                <div class="input-group">
                  <span class="input-group-addon">
                    <i class="fa fa-user"></i>
                  </span>
                  <input class="form-control file" type="file" name="img2" >
                </div>
              </div>
            </div>
          
            <div class="modal-footer">          
              <input type="number" hidden="True" name="empresa" value="{{ lastIdEmpresa }}">
              <input type="number" hidden="True" name="idUser" value="{{ login_user_id}}">  
              <button class="btn btn-outline-primary form-" type="submit" onclick="location.href='/'">Guardar</button>
            </div>
          </div>
        </div>
     </div>
    </form>
   
     
  </div>
</div>

<div id="openModalHijoDos" class="modalDialogHijoDos">
  <div> <a href="#close" title="Close" class="close"><i class="btn-outline-danger btn-outline-danger icofont-ui-close"></i></a>            
  
    
      <div class="modal-dialo" role="document">
        <form id="editReferencia">
          <div class="content text-light bg-dar">
            <div class="border">
              <center>
                <h1>Editar referencia {% for i in nomEmpresaU %}{{ i }}{% endfor %}</h1><hr>
              </center>
              
                <div class="col-sm-12">
                 
                 
                  <div class="form-group">
                    <label for="modal_codigo_color">Nombre Referencia</label>
                    <div class="input-group">
                      <span class="input-group-addon">
                        <i class="fa fa-user"></i>
                      </span>
                      <input class="form-control" type="text" name="nom_referenciaUP" placeholder="Nombre referencia" required>
                    </div>
                  </div>
                
                </div>                    
                <div class="col-sm-12">
                  <div class="form-group">
                    <label for="modal_codigo_color">Descripcion de Referencia</label>
                    <div class="input-group">
                      <span class="input-group-addon">
                        <i class="fa fa-user"></i>
                      </span>
                      <input class="form-control" type="text" name="descripcionUP" min="10" max="100" placeholder="Descripcion" required>
                    </div>
                  </div>
                </div>
                 <div class="col-sm-12">
                  <div class="form-group">
                    <label for="img1">img1</label>                      
                      <input class="form-control-file" name="img1UP" type="file">                   
                  </div>
                </div>
                <div class="col-sm-12">
                  <div class="form-group">
                    <label for="img2">img2</label>                      
                      <input  class="form-control-file" name="img2UP" type="file">                   
                  </div>
                </div>         
              
                  

                
                <div class="modal-footer">              
                  <input type="number" hidden="True" name="empresaUP" value="{{ lastIdEmpresa }}">
                  <input type="number" hidden="True" name="idUserUP" value="{{ login_user_id}}">
                  <button class="btn btn-outline-primary form-" type="submit" onclick="location.href='/'">Guardar</button>
                </div>
              
              
            
              
            </div>
            
          </div>
        </form>
      </div>
   
      </div>
</div>











{% block javascript %}

<!-- editar -->
<script>
  var $table = $('#tableReferencia')
  var $buttonEd = $('#buttonEditar')
  
  
  $(function() {
    $buttonEd.click(function () {
      
      var ids = $.map($table.bootstrapTable('getSelections'), function (row) {
        
      var idss = row.id;
      
$("form#editReferencia").submit(function() {
var nom_referenciaInputUP = $('input[name="nom_referenciaUP"]').val().trim();
var descripcionInputUP = $('input[name="descripcionUP"]').val().trim();
var img1InputUP = $('input[name="img1UP"]').val().trim();


var img2InputUP = $('input[name="img2UP"]').val().trim();
var idEmpresaInputUP = $('input[name="empresaUP"]').val().trim();
var idUserUP    = $('input[name="idUserUP"]').val().trim();

if (nom_referenciaInputUP && descripcionInputUP && img1InputUP && img2InputUP && idEmpresaInputUP && idUserUP && idss) {
    // Create Ajax Call
    $.ajax({
        url: '{% url "Referencia_ajax_update" %}',
        data: {
            'idReferencia':idss,
            'nom_referenciaUP': nom_referenciaInputUP,
            'descripcionUP': descripcionInputUP,
            'img1UP': img1InputUP,
            'img2UP': img2InputUP,
            'empresaUP':idEmpresaInputUP,
            'idUserUP':idUserUP
            
            
        },
        dataType: 'json',
        success: function (data) {
            if (data.editMsj) {
              alert("passsssssssssssssssssssssssssssssss");
            }
        }
    });

} else {
    console.log("All fields must have a valid value.");
}
$('form#editReferencia').trigger("reset");
return false;
});
  
      
      
      })
      
    })
  
  })
  


    var $button = $('#button')
  

  $(function() {
    $button.click(function () {
      
      var ids = $.map($table.bootstrapTable('getSelections'), function (row) {
        $.ajax({
    url: '{% url "Referencia_ajax_delete" %}',
    data: {
        'id': row.id,
    },
    dataType: 'json',
    success: function (data) {
        console.log("borrado")
    }
    });
        return row.id
      })
      $table.bootstrapTable('remove', {
        field: 'id',
        values: ids
      })
    })

  
  })
</script>


<!-- Crear -->
<script>
 function ajaxRequest(params) {
    var url = 'referencia/referencia-list/'
    $.get(url + '?' + $.param(params.data)).then(function (res) {
      params.success(res)
    })
  }
 
  $("form#addReferencia").submit(function() {


var nom_referenciaInput = $('input[name="nom_referencia"]').val().trim();
var descripcionInput = $('input[name="descripcion"]').val().trim();
var img1Input = $('input[name="img1"]').val().trim();
var img2Input = $('input[name="img2"]').val().trim();
var idEmpresaInput = $('input[name="empresa"]').val().trim();
var idUser    = $('input[name="idUser"]').val().trim();
if (nom_referenciaInput && descripcionInput && img1Input && img2Input && idEmpresaInput && idUser) {
    // Create Ajax Call
    $.ajax({
        url: '{% url "Referencia_ajax_create" %}',
        data: {
            
            'nom_referencia': nom_referenciaInput,
            'descripcion': descripcionInput,
            'img1': img1Input,
            'img2': img2Input,
            'empresa':idEmpresaInput,
            'idUser':idUser
            
            
        },
        dataType: 'json',
        success: function (data) {
            if (data.user) {
              appendToUsrTable(data.user);
            }
        }
    });

} else {
    alert("All fields must have a valid value.");
}
$('form#addReferencia').trigger("reset");
return false;
});


    </script>
    {% endblock javascript %}
