{% load static %}
<script src="{% static 'vendors/bootstrap/js/popper.js' %}"></script>
<script src="{% static 'vendors/jquery/jquery-3.2.1.min.js' %}"></script>
<!-- {% block title %}Django Ajax CRUD{% endblock %}
id="user -->
<link href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css" rel="stylesheet">

<script src="https://unpkg.com/tableexport.jquery.plugin/tableExport.min.js"></script>
<script src="{% static 'js/bootstrap-table.js' %}"></script>


<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table-locale-all.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/extensions/export/bootstrap-table-export.min.js"></script>



<div id="openModalPadre" class="modalDialogPadre">
    <div> <a href="#close" title="Close" class="close"><i class="btn-outline-danger icofont-ui-close"></i></a>            
      <center>
        <h1>Referencias {% for i in nomEmpresaU %}{{ i }}{% endfor %}</h1><hr>
      </center>

      


      
      
    <table id="table"
        data-locale="es-SP"
        class="table "
        data-toggle="table"
        data-click-to-select="true"
        data-height="460"
        data-pagination="true"
        data-ajax="ajaxRequest"
        data-search="true"
        data-show-fullscreen="true"        
        data-show-refresh="true"
        data-show-export="true" 
        data-url=""        
        > 
        <div class="row">
          <div class="col-sm-2">
          <a href="#openModalHijo"> 
              <i class="btn text-center btn-outline-success icofont-ui-add"> Agregar </i>
          </a>
        </div>
        
        <div class="col-sm-2">
          <div id="">
            <button id="buttonEditar" class="btn btn-outline-warning icofont-ui-edit"><a href="#openModalHijoDos">Editar</a> </button>
          </div>
        </div>

        <div class="col-sm-2">
          <div id="toolbar">
            <button id="button" class="btn btn-outline-danger icofont-ui-remove"> Eliminar</button>
          </div>
        </div>
        
    </div>

        <thead>                    
            <tr>
                <th class="text-center" data-field="state" data-checkbox="true"></th>
                <th class="text-center" data-field="nom_referencia">Nombre Referencia <i class="icofont-atom"></i></th>
                <th class="text-center" data-field="descripcion">Descripcion de Referencia <i   class="icofont-brand-appstore"></i></th>
                <th class="text-center" data-field="fotoPrendaUno">Imagen 1 <i class="icofont-image"></i></th>
                <th class="text-center" data-field="fotoPrendaDos">Imagen 1  <i class="icofont-image"></i></th>
                <th class="text-center" data-field="created_at">Fecha Creada <i class=""></i></th>
                
            </tr>
        </thead>     
     
    </table>
    
    </div>  

</div>  
<style>
 
.input-field label{color:#999;}
.input-field input[type=text]:focus + label,.input-field input[type=password]:focus + label{color:#000;}
.input-field input[type=text]:focus ,.input-field input[type=password]:focus {border-bottom:1px solid #000;box-shadow:0 1px 0 0 #000;}
.input-field input[type=text].valid,.input-field input[type=password].valid{border-bottom:1px solid #2196F3;box-shadow:0 1px 0 0 #2196F3;}
.input-field input[type=text].invalid,.input-field input[type=password].invalid{border-bottom:1px solid #F44336;box-shadow:0 1px 0 0 #F44336;}
.input-field .prefix.active{color:#000;}
/* Input : switch */
.switch{margin-top:7px;}
.switch label .lever{margin:0 7px;}
.switch label input[type="checkbox"]:checked + .lever{background-color:#ADD0EB;}
.switch label input[type="checkbox"]:checked + .lever::after{background-color: #4FB0FD ;}
.login-body{background-image:url(http://i.imgur.com/aBayW5C.png);background-size:cover;background-position: center;background-attachment:fixed;}
.input-cart{min-height:400px;border-top:3px solid #2196F3;margin-top:80px;margin-bottom:100px;}
.login{margin-top:25px;border-right:1px solid #ddd;}
.policy{visibility: hidden;}
.signupForm{display: none;}
.signup{margin-top:25px;}
.signup-toggle{cursor:pointer;margin-top:140px;}
.login h4, .signup h4{font-weight:200;}
.legal{border-top:1px solid #ddd;}
.email label{margin-left:11px;}
.policy{font-size:13px;}
.main-title{font-family:pacifico;}
</style>




<div id="openModalHijo" class="modalDialogHijo">
    <div> <a href="#close" title="Close" class="close"><i class="icofont-ui-close"></i></a>            
      <center>
        <h1>Crear referencia {% for i in nomEmpresaU %}{{ i }}{% endfor %}</h1><hr>
      </center>
<!--       
        <div class="modal-dialog" role="document">
          <form id="addReferencia" action="" novalidate="novalidate">
            <div class="modal-content">
              
              <div class="modal-body">
                <div class="form-row">
                  <div class="col-sm-6">
                   
                   
                    <div class="form-group">
                      <label for="modal_codigo_color">Nombre Referencia</label>
                      <div class="input-group">
                        <span class="input-group-addon">
                          <i class="fa fa-user"></i>
                        </span>
                        <input class="form-control" type="text" name="nom_referencia" placeholder="Nombre referencia" required>
                      </div>
                    </div>
                  
                  </div>
                 
                 
                  <div class="col-sm-6">
                    <div class="form-group">
                      <label for="modal_codigo_color">Descripcion de Referencia</label>
                      <div class="input-group">
                        <span class="input-group-addon">
                          <i class="fa fa-user"></i>
                        </span>
                        <input class="form-control" type="text" name="descripcion" min="10" max="100" placeholder="Descripcion" required>
                      </div>
                    </div>
                  </div>


                  
                  <div class="col-sm-6">
                    <div class="form-group">
                      <label for="img1">img1</label>                      
                        <input class="form-control-file" name="img1" type="file">                   
                    </div>
                  </div>

                  <div class="col-sm-6">
                    <div class="form-group">
                      <label for="img2">img2</label>                      
                        <input  class="form-control-file" name="img2" type="file">                   
                    </div>
                  </div>


                
                
                
                </div>
              
                
              </div>
              <div class="modal-footer">
                
                <input type="number" hidden="True" name="empresa" value="{{ lastIdEmpresa }}">
							  <input type="number" hidden="True" name="idUser" value="{{ login_user_id}}">  

                <button class="btn btn-outline-primary form-control" type="submit" onclick="location.href='/'">Guardar</button>
              </div>
            </div>
          </form>
        </div>
     
 -->











 






     
        </div>
</div>

<div id="openModalHijoDos" class="modalDialogHijoDos">
  <div> <a href="#close" title="Close" class="close"><i class="icofont-ui-close"></i></a>            
    <center>
      <h1>Editar referencia {% for i in nomEmpresaU %}{{ i }}{% endfor %}</h1><hr>
    </center>
    
      <div class="modal-dialog" role="document">
        <form id="editReferencia" action="" novalidate="novalidate">
          <div class="modal-content">
            
            <div class="modal-body">
              <div class="form-row">
                <div class="col-sm-6">
                 
                 
                  <div class="form-group">
                    <label for="modal_codigo_color">Nombre Referencia</label>
                    <div class="input-group">
                      <span class="input-group-addon">
                        <i class="fa fa-user"></i>
                      </span>
                      <input class="form-control" type="text" name="nom_referenciaUP" placeholder="Nombre referencia" required>
                    </div>
                  </div>
                
                </div>
               
               
                <div class="col-sm-6">
                  <div class="form-group">
                    <label for="modal_codigo_color">Descripcion de Referencia</label>
                    <div class="input-group">
                      <span class="input-group-addon">
                        <i class="fa fa-user"></i>
                      </span>
                      <input class="form-control" type="text" name="descripcionUP" min="10" max="100" placeholder="Descripcion" required>
                    </div>
                  </div>
                </div>


                
                <div class="col-sm-6">
                  <div class="form-group">
                    <label for="img1">img1</label>                      
                      <input class="form-control-file" name="img1UP" type="file">                   
                  </div>
                </div>

                <div class="col-sm-6">
                  <div class="form-group">
                    <label for="img2">img2</label>                      
                      <input  class="form-control-file" name="img2UP" type="file">                   
                  </div>
                </div>


              
              
              
              </div>
            
              
            </div>
            <div class="modal-footer">
              
              <input type="number" hidden="True" name="empresaUP" value="{{ lastIdEmpresa }}">
              <input type="number" hidden="True" name="idUserUP" value="{{ login_user_id}}">  

              <button class="btn btn-outline-primary form-control" type="submit" onclick="location.href='/'">Guardar</button>
            </div>
          </div>
        </form>
      </div>
   










   
      </div>
</div>











{% block javascript %}

<!-- editar -->
<script>
  var $table = $('#table')
  var $buttonEd = $('#buttonEditar')
  
  
  $(function() {
    $buttonEd.click(function () {
      
      var ids = $.map($table.bootstrapTable('getSelections'), function (row) {
        
      var idss = row.id;
      
$("form#editReferencia").submit(function() {
var nom_referenciaInputUP = $('input[name="nom_referenciaUP"]').val().trim();
var descripcionInputUP = $('input[name="descripcionUP"]').val().trim();
var img1InputUP = $('input[name="img1UP"]').val().trim();


var img2InputUP = $('input[name="img2UP"]').val().trim();
var idEmpresaInputUP = $('input[name="empresaUP"]').val().trim();
var idUserUP    = $('input[name="idUserUP"]').val().trim();

alert(nom_referenciaInputUP,descripcionInputUP,img1InputUP,img2InputUP,idEmpresaInputUP,idUserUP);
if (nom_referenciaInputUP && descripcionInputUP && img1InputUP && img2InputUP && idEmpresaInputUP && idUserUP && idss) {
    // Create Ajax Call
    $.ajax({
        url: '{% url "Referencia_ajax_update" %}',
        data: {
            'idReferencia':idss,
            'nom_referenciaUP': nom_referenciaInputUP,
            'descripcionUP': descripcionInputUP,
            'img1UP': img1InputUP,
            'img2UP': img2InputUP,
            'empresaUP':idEmpresaInputUP,
            'idUserUP':idUserUP
            
            
        },
        dataType: 'json',
        success: function (data) {
            if (data.editMsj) {
              alert("passsssssssssssssssssssssssssssssss");
            }
        }
    });

} else {
    alert("All fields must have a valid value.");
}
$('form#editReferencia').trigger("reset");
return false;
});
  
      
      
      })
      
    })
  
  })
  


    var $button = $('#button')
  

  $(function() {
    $button.click(function () {
      
      var ids = $.map($table.bootstrapTable('getSelections'), function (row) {
        $.ajax({
    url: '{% url "Referencia_ajax_delete" %}',
    data: {
        'id': row.id,
    },
    dataType: 'json',
    success: function (data) {
        console.log("borrado")
    }
});
        return row.id
      })
      $table.bootstrapTable('remove', {
        field: 'id',
        values: ids
      })
    })

  
  })
</script>



<!-- Crear -->
<script>
 function ajaxRequest(params) {
    var url = 'referencia/referencia-list/'
    $.get(url + '?' + $.param(params.data)).then(function (res) {
      params.success(res)
    })
  }
 
  $("form#addReferencia").submit(function() {


var nom_referenciaInput = $('input[name="nom_referencia"]').val().trim();
var descripcionInput = $('input[name="descripcion"]').val().trim();
var img1Input = $('input[name="img1"]').val().trim();
var img2Input = $('input[name="img2"]').val().trim();
var idEmpresaInput = $('input[name="empresa"]').val().trim();
var idUser    = $('input[name="idUser"]').val().trim();
if (nom_referenciaInput && descripcionInput && img1Input && img2Input && idEmpresaInput && idUser) {
    // Create Ajax Call
    $.ajax({
        url: '{% url "Referencia_ajax_create" %}',
        data: {
            
            'nom_referencia': nom_referenciaInput,
            'descripcion': descripcionInput,
            'img1': img1Input,
            'img2': img2Input,
            'empresa':idEmpresaInput,
            'idUser':idUser
            
            
        },
        dataType: 'json',
        success: function (data) {
            if (data.user) {
              appendToUsrTable(data.user);
            }
        }
    });

} else {
    alert("All fields must have a valid value.");
}
$('form#addReferencia').trigger("reset");
return false;
});


    </script>
    {% endblock javascript %}
